<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.kh.mvc.hobby.model.mapper.HobbyMapper">

   <sql id="HobbyListSql">
      SELECT HB_NO,
         MER_NO,
         CATE_NO,
         HB_TITLE,
         HB_SUMMARY,
         HB_STARTDATE,
         HB_FEE,
         HB_DISCOUNT_RATE,
         HB_DISCOUNT_STATUS,
         HB_ENDDATE,
         HB_IMGS_ORI,
         HB_IMGS_RENAME,
         HB_THUM_ORI,
         HB_THUM_RENAME,
         HB_INFO,
         HB_LOCATION
      FROM HOBBY
      WHERE
      STATUS = 'Y'
   </sql>

   <sql id="cateListSql">
      SELECT
      CATE_NO,
      CATE_NAME
      FROM
      CATEGORY
   </sql>

   <resultMap type="Hobby" id="HobbyListResultMap">
      <id property="hbNo" column="HB_NO" />
      <result property="merNo" column="MER_NO" />
      <result property="cateNo" column="CATE_NO" />
      <result property="cateName" column="CATE_NAME" />
      <result property="hbTitle" column="HB_TITLE" />
      <result property="hbSummary" column="HB_SUMMARY" />
      <result property="hbFee" column="HB_FEE" />
      <result property="hbDiscountRate" column="HB_DISCOUNT_RATE" />
      <result property="hbDiscountStatus" column="HB_DISCOUNT_STATUS" />
      <result property="hbStartDate" column="HB_STARTDATE" />
      <result property="hbEndDate" column="HB_ENDDATE" />
      <result property="hbImgsOri" column="HB_IMGS_ORI" />
      <result property="hbImgsRename" column="HB_IMGS_RENAME" />
      <result property="hbThumOri" column="HB_THUM_ORI" />
      <result property="hbThumRename" column="HB_THUM_RENAME" />
      <result property="hbInfo" column="HB_INFO" />
      <result property="hbLocation" column="HB_LOCATION" />
   </resultMap>


   <resultMap type="Category" id="CateListResultMap">
      <id property="cateNo" column="CATE_NO" />
      <result property="cateName" column="CATE_NAME" />
   </resultMap>

   <select id="selectCateList" parameterType="map"
      resultMap="CateListResultMap">

      <include refid="cateListSql" />

      ORDER BY CATE_NO DESC
   </select>


   <select id="selectHobbyList" parameterType="map"
      resultMap="HobbyListResultMap">

      SELECT H.HB_NO,
         H.MER_NO,
         H.CATE_NO,
         C.CATE_NAME,
         H.HB_TITLE,
         H.HB_SUMMARY,
         H.HB_STARTDATE,
         H.HB_FEE,
         H.HB_DISCOUNT_RATE,
         H.HB_DISCOUNT_STATUS,
         H.HB_ENDDATE,
         H.HB_IMGS_ORI,
         H.HB_IMGS_RENAME,
         H.HB_THUM_ORI,
         H.HB_THUM_RENAME,
         H.HB_INFO,
         H.HB_LOCATION
      FROM HOBBY H
      JOIN CATEGORY C ON(H.CATE_NO = C.CATE_NO)
      WHERE H.STATUS = 'Y'

      ORDER BY H.HB_NO DESC

   </select>
   
      <select id="getHobbySearchList" parameterType="map"
      resultMap="HobbyListResultMap">

      SELECT H.HB_NO,
         H.MER_NO,
         H.CATE_NO,
         C.CATE_NAME,
         H.HB_TITLE,
         H.HB_SUMMARY,
         H.HB_STARTDATE,
         H.HB_FEE,
         H.HB_DISCOUNT_RATE,
         H.HB_DISCOUNT_STATUS,
         H.HB_ENDDATE,
         H.HB_IMGS_ORI,
         H.HB_IMGS_RENAME,
         H.HB_THUM_ORI,
         H.HB_THUM_RENAME,
         H.HB_INFO,
         H.HB_LOCATION
      FROM HOBBY H
      JOIN CATEGORY C ON(H.CATE_NO = C.CATE_NO)
      WHERE H.STATUS = 'Y'
     AND  H.HB_TITLE LIKE '%' || #{search} || '%' 

      ORDER BY H.HB_NO DESC

   </select>
   
   
   
    <select id="selectHobbySearchCount" parameterType="String"
      resultType="_int">
      SELECT COUNT(*)
      FROM HOBBY
      WHERE STATUS='Y'
      AND HB_TITLE LIKE '%' || #{search} || '%' 
   </select>

   <select id="selectHobbyCount" parameterType="map"
      resultType="_int">
      SELECT COUNT(*)
      FROM HOBBY
      WHERE STATUS='Y'
   </select>

   <insert id="insertHobby" parameterType="map"
      useGeneratedKeys="true" keyProperty="hbNo" keyColumn="HB_NO">
      INSERT INTO HOBBY(
      HB_NO,
      MER_NO,
      CATE_NO,
      HB_TITLE,
      HB_FEE,
      HB_DISCOUNT_RATE,
      HB_DISCOUNT_STATUS,
      HB_SUMMARY,
      HB_STARTDATE,
      HB_ENDDATE,
      HB_IMGS_ORI,
      HB_IMGS_RENAME,
      HB_THUM_ORI,
      HB_THUM_RENAME,
      HB_INFO,
      HB_LOCATION,
      STATUS
      ) VALUES(
      SEQ_HOBBY_NO.NEXTVAL,
      1,
      #{cateNo},
      #{hbTitle},
      TO_NUMBER(#{hbFee}),
      TO_NUMBER(#{hbDiscountRate}),
      #{hbDiscountStatus},
      #{hbSummary},
      TO_DATE(#{hbStartDate},'YYYY-MM-DD'),
      TO_DATE(#{hbEndDate},'YYYY-MM-DD'),
      #{hbImgsOri},
      #{hbImgsRename},
      #{hbThumOri},
      #{hbThumRename},
      #{hbInfo},
      #{hbLocation},
      'Y'
      )
   </insert>
</mapper>