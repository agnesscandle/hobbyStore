<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
 <mapper namespace="com.kh.mvc.member.model.mapper.MemberMapper">
 	<sql id="selectMemberSql">
 		SELECT  MEM_NO, 
			    MEM_ID, 
			    MEM_PASSWORD, 
			    MEM_EMAIL,
			    MEM_NAME, 
			    MEM_PHONE, 
			    STATUS, 
			    MEM_IMG_ORIGINAL, 
			    MEM_IMG_RENAME, 
			    MEM_DATE 
		FROM MEMBER
 	</sql>
 
 	<resultMap type="Member" id="memberResultMap">
 		<id property="memNo" column="MEM_NO"/>
 		<result property="memId" column="MEM_ID" />
 		<result property="memPassword" column="MEM_PASSWORD"/>
 		<result property="memEmail" column="MEM_EMAIL"/>
 		<result property="memName" column="MEM_NAME"/>
 		<result property="memPhone" column="MEM_PHONE"/>
 		<result property="status" column="STATUS"/>
 		<result property="memImgOriginal" column="MEM_IMG_ORIGINAL"/>
 		<result property="memImgRename" column="MEM_IMG_RENAME"/>
 		<result property="status" column="STATUS"/>
 		<result property="memDate" column="MEM_DATE"/>
 		<result property="cateNo" column="CATE_NO"/>
 	</resultMap>
 	
 	<select id="selectMember" parameterType="string" resultMap="memberResultMap">
 		<include refid="selectMemberSql" />
		WHERE MEM_ID = #{memId} AND STATUS ='Y'
 	</select>
 	
 	<!-- 이메일 중복 검사 -->
 	<select id="searchEmail" parameterType="string" resultMap="memberResultMap">
 		<include refid="selectMemberSql" />
		WHERE MEM_EMAIL = #{memEmail} AND STATUS ='Y'
 	</select>
 	
	<!-- 아이디 찾기 -->
	<select id="findId" parameterType="String" resultMap="memberResultMap">
		SELECT MEM_ID FROM MEMBER 
		WHERE MEM_NAME = #{memName} 
		AND MEM_EMAIL = #{memEmail}
	</select>
 	
 	<insert id="insertMember" parameterType="Member"
 		useGeneratedKeys="true" keyColumn="MEM_NO" keyProperty="memNo" >

		INSERT INTO MEMBER (
			MEM_NO,
			MEM_ID,
			MEM_PASSWORD,
			MEM_EMAIL,
			MEM_NAME,
			MEM_PHONE,
			STATUS,
			MEM_IMG_ORIGINAL,
			MEM_IMG_RENAME,
			MEM_DATE
		) VALUES(
			SEQ_MEM_NO.NEXTVAL, 
			#{memId},
			#{memPassword},
			#{memEmail},
			#{memName},
			#{memPhone},
			DEFAULT,
			#{memImgOriginal},
			#{memImgRename},
			DEFAULT
		)
 	</insert>
 	
 	<!-- 비밀번호 업데이트 -->
 	<update id="updateMemPwd" parameterType="Member">
 		UPDATE MEMBER 
 		SET
 			MEM_PASSWORD = #{memPassword}
		WHERE MEM_NO = #{memNo}
	</update>
 			
 		
 		 
 	<update id="updateMember" parameterType="Member">
 		UPDATE MEMBER 
 		SET 
 			MEM_NAME = #{memName},
 			MEM_PHONE = #{memPhone},
 			MEM_EMAIL = #{memEmail}
		WHERE MEM_NO = #{memNo}
 	</update>
 	
 	<update id="deleteMember" parameterType="_int">
 		UPDATE MEMBER
 		SET
 			STATUS='N'
 		WHERE
 			MEM_NO = #{memNo}
 	</update>
 </mapper>